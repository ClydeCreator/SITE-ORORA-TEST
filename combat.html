<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Combat - ORORA</title>
    
    <meta name="description" content="Simulateur de combat Orora - Affrontez vos amis !">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ORORA">
    
    <link rel="icon" type="image/png" href="icons/IconApp.png">
    <link rel="apple-touch-icon" href="icons/AppImages/ios/180.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1, h2, h3, .player-name, .btn-text {
            font-family: 'Bebas Neue', 'Arial Black', sans-serif;
            letter-spacing: 1px;
        }

        .header {
            text-align: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9em;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .logo {
            height: 50px;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        .page-title {
            font-size: 2em;
            background: linear-gradient(135deg, #ff6ec7, #7873f5, #4aeadc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* SELECTION PHASE */
        .selection-phase {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .selection-step-title {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4aeadc, #7873f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .selection-step-title.p2 {
            background: linear-gradient(135deg, #ff6ec7, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .selected-card-display {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .selected-card-wrapper {
            position: relative;
            width: 220px;
            perspective: 1000px;
        }

        .selected-card-container {
            position: relative;
            width: 100%;
            aspect-ratio: 3 / 4;
            border-radius: 15px;
            overflow: visible;
        }

        .selected-card-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .selected-card-container.p1:not(.empty) img {
            border: 3px solid #4aeadc;
            box-shadow: 0 0 30px rgba(74, 234, 220, 0.4);
        }

        .selected-card-container.p2:not(.empty) img {
            border: 3px solid #ff6ec7;
            box-shadow: 0 0 30px rgba(255, 110, 199, 0.4);
        }

        .selected-card-container.empty img {
            border: 3px dashed rgba(255, 255, 255, 0.3);
            box-shadow: none;
        }

        .selected-hp-display {
            position: absolute;
            top: -15px;
            right: -15px;
            z-index: 10;
        }

        .selected-hp-display .hp-img {
            width: 55px !important;
            height: auto !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
        }

        .selected-hp-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3em;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .search-container {
            max-width: 600px;
            width: 100%;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #333;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .search-input::placeholder {
            color: #888;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .character-card {
            position: relative;
            aspect-ratio: 3 / 4;
            border-radius: 15px;
            cursor: pointer;
            perspective: 1000px;
        }

        .character-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s ease;
            transform-style: preserve-3d;
        }

        .character-card.revealed .character-card-inner {
            transform: rotateY(0deg);
        }

        .character-card-front,
        .character-card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            overflow: hidden;
            transition: box-shadow 0.3s ease;
        }

        .character-card-front {
            z-index: 2;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .character-card-back {
            transform: rotateY(180deg);
            z-index: 1;
        }

        .character-card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .character-card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, transparent 50%, rgba(0, 0, 0, 0.95) 100%);
            z-index: 1;
            border-radius: 15px;
        }

        .character-card-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .character-card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            z-index: 2;
        }

        .character-card h3 {
            font-size: 1.1em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .character-card-info {
            font-size: 0.8em;
            color: #ddd;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .faction-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .faction-badge.alliance { background: #3498db; }
        .faction-badge.rebellion { background: #e74c3c; }
        .faction-badge.trefonds { background: #2ecc71; }

        .character-card.alliance:hover .character-card-front {
            box-shadow: 0 0 25px rgba(52, 152, 219, 0.7), 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .character-card.rebellion:hover .character-card-front {
            box-shadow: 0 0 25px rgba(231, 76, 60, 0.7), 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .character-card.trefonds:hover .character-card-front {
            box-shadow: 0 0 25px rgba(46, 204, 113, 0.7), 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .character-card.revealed .character-card-inner.tilt {
            transition: transform 0.1s ease-out;
        }

        /* Stats Modal */
        .stats-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
        }

        .stats-modal.active {
            display: flex;
        }

        .stats-modal-card {
            width: 280px;
            aspect-ratio: 3 / 4;
            border-radius: 15px;
            overflow: hidden;
        }

        .stats-modal-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .stats-modal-content {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            max-width: 350px;
            text-align: center;
        }

        .stats-modal-name {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
        }

        .stat-label {
            font-size: 0.7em;
            color: #888;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #4aeadc;
        }

        .select-btn {
            padding: 15px 40px;
            font-size: 1.5em;
            font-family: 'Bebas Neue', sans-serif;
            background: linear-gradient(135deg, #4aeadc, #7873f5);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 2px;
        }

        .select-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(74, 234, 220, 0.4);
        }

        .select-btn.p2 {
            background: linear-gradient(135deg, #ff6ec7, #f39c12);
        }

        .select-btn.p2:hover {
            box-shadow: 0 10px 30px rgba(255, 110, 199, 0.4);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2.5em;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        .next-step-btn {
            padding: 20px 60px;
            font-size: 1.8em;
            font-family: 'Bebas Neue', sans-serif;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 30px rgba(243, 156, 18, 0.4);
            margin-top: 30px;
            letter-spacing: 2px;
        }

        .next-step-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(243, 156, 18, 0.6);
        }

        .next-step-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* BATTLE PHASE */
        .battle-phase {
            display: none;
            padding: 20px;
        }

        .battle-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .turn-indicator {
            display: inline-block;
            font-size: 1.3em;
            padding: 12px 25px;
            background: rgba(243, 156, 18, 0.2);
            border-radius: 25px;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .turn-indicator .turn-name {
            color: #f39c12;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2em;
        }

        .battle-arena {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 60px;
            min-height: calc(100vh - 280px);
        }

        .combatant {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .combatant.active .combat-card-container {
            animation: pulse-glow 1s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(243, 156, 18, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(243, 156, 18, 0.8)); }
        }

        .combat-card-wrapper {
            position: relative;
            perspective: 1000px;
        }

        .combat-card-container {
            position: relative;
            width: 300px;
            aspect-ratio: 3 / 4;
            border-radius: 15px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        .combat-card-container.disabled {
            cursor: not-allowed;
        }

        .combat-card-container.disabled::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            z-index: 5;
        }

        .combat-card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
            border: 3px solid transparent;
        }

        .combat-card-container.alliance .combat-card-img { border-color: #3498db; }
        .combat-card-container.rebellion .combat-card-img { border-color: #e74c3c; }
        .combat-card-container.trefonds .combat-card-img { border-color: #2ecc71; }

        .holographic-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            pointer-events: none;
            background: linear-gradient(125deg, transparent 0%, transparent 25%, rgba(255, 255, 255, 0.1) 25%, rgba(255, 255, 255, 0.3) 30%, transparent 35%, transparent 100%);
            background-size: 200% 200%;
            mix-blend-mode: overlay;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .rainbow-shine {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            pointer-events: none;
            background: linear-gradient(var(--shine-angle, 135deg), transparent 0%, rgba(255, 0, 128, 0.15) 15%, rgba(0, 255, 255, 0.15) 30%, rgba(255, 255, 0, 0.15) 45%, rgba(0, 255, 128, 0.15) 60%, rgba(128, 0, 255, 0.15) 75%, transparent 100%);
            mix-blend-mode: color-dodge;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .light-reflection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            pointer-events: none;
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 20%, transparent 50%);
            mix-blend-mode: overlay;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .combat-card-container:hover .holographic-overlay,
        .combat-card-container:hover .rainbow-shine,
        .combat-card-container:hover .light-reflection {
            opacity: 1;
        }

        .combat-card-container.ko {
            animation: ko-fall 0.8s ease-out forwards;
        }

        @keyframes ko-fall {
            0% { transform: rotate(0deg) scale(1); filter: grayscale(0%) brightness(1); }
            100% { transform: rotate(8deg) scale(0.95) translateY(20px); filter: grayscale(100%) brightness(0.5); }
        }

        .hp-display {
            position: absolute;
            top: -20px;
            right: -20px;
            z-index: 10;
        }

        .hp-container {
            position: relative;
            width: 70px;
            height: 70px;
        }

        .hp-container .hp-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.5));
        }

        .hp-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5em;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .combat-feedback {
            position: absolute;
            top: -55px;
            right: -10px;
            z-index: 11;
            text-align: center;
        }

        .damage-text {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2em;
            color: #ff4444;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            opacity: 0;
            pointer-events: none;
        }

        .damage-text.show {
            animation: damage-pop 1s ease-out forwards;
        }

        @keyframes damage-pop {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            80% { opacity: 1; transform: translateY(-20px) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(0.8); }
        }

        .dodge-text {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5em;
            color: #4aeadc;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            opacity: 0;
            pointer-events: none;
        }

        .dodge-text.show {
            animation: dodge-pop 1s ease-out forwards;
        }

        @keyframes dodge-pop {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.1); }
            80% { opacity: 1; transform: translateY(-20px) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(0.8); }
        }

        .player-name {
            font-size: 2.2em;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .battle-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .attack-indicator {
            width: 80px;
            height: 80px;
            transition: transform 0.3s ease;
        }

        .attack-indicator img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .attack-indicator.point-left {
            transform: scaleX(-1);
        }

        .attack-indicator.point-right {
            transform: scaleX(1);
        }

        .auto-battle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auto-battle-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #4aeadc;
        }

        .auto-battle-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2em;
            letter-spacing: 1px;
            cursor: pointer;
        }

        .battle-log {
            max-width: 600px;
            margin: 20px auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry {
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 8px;
            font-size: 0.85em;
            animation: slide-in 0.3s ease;
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-entry.attack { background: rgba(243, 156, 18, 0.2); border-left: 3px solid #f39c12; }
        .log-entry.dodge { background: rgba(74, 234, 220, 0.2); border-left: 3px solid #4aeadc; }
        .log-entry.victory { background: rgba(46, 204, 113, 0.2); border-left: 3px solid #2ecc71; }
        .log-entry.info { background: rgba(255, 255, 255, 0.1); border-left: 3px solid #888; }

        /* Victory */
        .victory-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 30px;
        }

        .victory-overlay.show {
            display: flex;
            animation: fade-in 0.5s ease;
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .victory-title {
            font-size: 3.5em;
            text-align: center;
            background: linear-gradient(135deg, #f39c12, #f1c40f, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: victory-glow 1s infinite alternate;
        }

        @keyframes victory-glow {
            from { filter: drop-shadow(0 0 10px rgba(243, 156, 18, 0.5)); }
            to { filter: drop-shadow(0 0 30px rgba(243, 156, 18, 0.8)); }
        }

        .winner-card {
            width: 220px;
            aspect-ratio: 3 / 4;
            border-radius: 15px;
            overflow: hidden;
            border: 4px solid #f39c12;
            box-shadow: 0 0 50px rgba(243, 156, 18, 0.5);
        }

        .winner-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .winner-name {
            font-size: 2.5em;
        }

        .victory-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .rematch-btn, .new-battle-btn {
            padding: 15px 40px;
            font-size: 1.4em;
            font-family: 'Bebas Neue', sans-serif;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .rematch-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .new-battle-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .rematch-btn:hover, .new-battle-btn:hover {
            transform: scale(1.05);
        }

        /* MOBILE */
        @media (max-width: 900px) {
            .header {
                padding: 10px;
            }

            .back-btn {
                position: relative;
                left: auto;
                top: auto;
                transform: none;
                margin-bottom: 10px;
            }

            .header-content {
                flex-direction: column;
                gap: 5px;
            }

            .logo {
                height: 35px;
            }

            .page-title {
                font-size: 1.4em;
            }

            .selection-step-title {
                font-size: 1.8em;
            }

            .selected-card-wrapper {
                width: 150px;
            }

            .character-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 12px;
            }

            .character-card h3 {
                font-size: 0.8em;
            }

            .faction-badge {
                font-size: 0.6em;
                padding: 2px 6px;
            }

            /* COMBAT MOBILE - FULLSCREEN */
            .battle-phase {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                padding: 10px;
                background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
                z-index: 1000;
                overflow: hidden;
            }

            .battle-phase .battle-header {
                display: none;
            }

            .battle-arena {
                flex-direction: column;
                height: 100%;
                gap: 10px;
                justify-content: space-between;
                padding: 5px 0;
            }

            /* Player 1 en haut - RETOURN√â √† 180¬∞ */
            .combatant.player1-mobile {
                transform: rotate(180deg);
                order: 1;
            }

            .battle-center {
                order: 2;
                flex-direction: row;
                gap: 15px;
            }

            .combatant.player2-mobile {
                order: 3;
            }

            .combat-card-container {
                width: 40vw;
                max-width: 180px;
            }

            .hp-display {
                top: -15px;
                right: -15px;
            }

            .hp-container {
                width: 50px;
                height: 50px;
            }

            .hp-value {
                font-size: 1.1em;
            }

            .combat-feedback {
                top: -40px;
            }

            .damage-text {
                font-size: 1.5em;
            }

            .dodge-text {
                font-size: 1.2em;
            }

            .player-name {
                font-size: 1.3em;
            }

            .attack-indicator {
                width: 50px;
                height: 50px;
            }

            .battle-log {
                display: none;
            }

            .auto-battle-container {
                padding: 8px 15px;
            }

            .auto-battle-label {
                font-size: 1em;
            }

            .victory-title {
                font-size: 2.5em;
            }

            .winner-card {
                width: 180px;
            }

            .winner-name {
                font-size: 2em;
            }

            .rematch-btn, .new-battle-btn {
                padding: 12px 30px;
                font-size: 1.2em;
            }
        }

        @media (max-width: 400px) {
            .combat-card-container {
                width: 38vw;
            }

            .player-name {
                font-size: 1.1em;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <header class="header" id="mainHeader">
        <div class="header-content">
            <a href="index.html" class="back-btn">‚Üê Retour</a>
            <img src="logo.png" alt="ORORA" class="logo">
            <h1 class="page-title">SIMULATEUR DE COMBAT</h1>
        </div>
    </header>

    <div id="selectionPhase" class="selection-phase">
        <div id="step1" class="selection-step">
            <h2 class="selection-step-title">S√âLECTIONNER JOUEUR 1</h2>
            
            <div class="selected-card-display">
                <div class="selected-card-wrapper">
                    <div class="selected-card-container p1 empty" id="selectedCardP1">
                        <img src="./cards/dos.png" alt="Carte" id="selectedImgP1">
                    </div>
                    <div class="selected-hp-display" id="selectedHpP1" style="display: none;">
                        <img src="./icons/PV.png" alt="PV" class="hp-img">
                        <span class="selected-hp-value" id="selectedHpValueP1">0</span>
                    </div>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" id="searchP1" placeholder="Rechercher un personnage...">
            </div>

            <div class="character-grid" id="gridP1"></div>

            <button class="next-step-btn" id="nextToP2Btn" disabled>SUIVANT ‚Üí</button>
        </div>

        <div id="step2" class="selection-step" style="display: none;">
            <h2 class="selection-step-title p2">S√âLECTIONNER JOUEUR 2</h2>
            
            <div class="selected-card-display">
                <div class="selected-card-wrapper">
                    <div class="selected-card-container p2 empty" id="selectedCardP2">
                        <img src="./cards/dos.png" alt="Carte" id="selectedImgP2">
                    </div>
                    <div class="selected-hp-display" id="selectedHpP2" style="display: none;">
                        <img src="./icons/PV.png" alt="PV" class="hp-img">
                        <span class="selected-hp-value" id="selectedHpValueP2">0</span>
                    </div>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" id="searchP2" placeholder="Rechercher un personnage...">
            </div>

            <div class="character-grid" id="gridP2"></div>

            <button class="next-step-btn" id="startBattleBtn" disabled>‚öîÔ∏è LANCER LE COMBAT ‚öîÔ∏è</button>
        </div>
    </div>

    <div class="stats-modal" id="statsModal">
        <span class="close-modal" onclick="closeStatsModal()">&times;</span>
        <div class="stats-modal-card">
            <img id="modalCardImg" src="" alt="">
        </div>
        <div class="stats-modal-content">
            <h2 class="stats-modal-name" id="modalName"></h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">PV</div>
                    <div class="stat-value" id="modalPV">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Attaque</div>
                    <div class="stat-value" id="modalATK">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">D√©fense</div>
                    <div class="stat-value" id="modalDEF">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Strat√©gie</div>
                    <div class="stat-value" id="modalSTR">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Vitesse</div>
                    <div class="stat-value" id="modalVIT">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Niveau</div>
                    <div class="stat-value" id="modalLVL">0</div>
                </div>
            </div>
            <button class="select-btn" id="modalSelectBtn" onclick="confirmSelection()">S√âLECTIONNER</button>
        </div>
    </div>

    <div id="battlePhase" class="battle-phase">
        <div class="battle-header">
            <div class="turn-indicator" id="turnIndicator">
                C'est au tour de <span class="turn-name" id="turnName">...</span>
            </div>
        </div>

        <div class="battle-arena">
            <div class="combatant player1-mobile" id="combatant1">
                <div class="combat-card-wrapper">
                    <div class="combat-feedback" id="feedback1">
                        <div class="damage-text" id="damage1"></div>
                        <div class="dodge-text" id="dodge1">ESQUIVE!</div>
                    </div>
                    <div class="hp-display">
                        <div class="hp-container">
                            <img src="./icons/PV.png" alt="PV" class="hp-img">
                            <span class="hp-value" id="hp1">0</span>
                        </div>
                    </div>
                    <div class="combat-card-container" id="card1" onclick="playerAttack(1)">
                        <img class="combat-card-img" id="cardImg1" src="" alt="">
                        <div class="holographic-overlay"></div>
                        <div class="rainbow-shine"></div>
                        <div class="light-reflection"></div>
                    </div>
                </div>
                <div class="player-name" id="name1"></div>
            </div>

            <div class="battle-center">
                <div class="attack-indicator" id="attackIndicator">
                    <img src="./icons/ATT.gif" alt="Attaque">
                </div>
                <div class="auto-battle-container">
                    <input type="checkbox" class="auto-battle-checkbox" id="autoBattle">
                    <label class="auto-battle-label" for="autoBattle">AUTO</label>
                </div>
            </div>

            <div class="combatant player2-mobile" id="combatant2">
                <div class="combat-card-wrapper">
                    <div class="combat-feedback" id="feedback2">
                        <div class="damage-text" id="damage2"></div>
                        <div class="dodge-text" id="dodge2">ESQUIVE!</div>
                    </div>
                    <div class="hp-display">
                        <div class="hp-container">
                            <img src="./icons/PV.png" alt="PV" class="hp-img">
                            <span class="hp-value" id="hp2">0</span>
                        </div>
                    </div>
                    <div class="combat-card-container" id="card2" onclick="playerAttack(2)">
                        <img class="combat-card-img" id="cardImg2" src="" alt="">
                        <div class="holographic-overlay"></div>
                        <div class="rainbow-shine"></div>
                        <div class="light-reflection"></div>
                    </div>
                </div>
                <div class="player-name" id="name2"></div>
            </div>
        </div>

        <div class="battle-log" id="battleLog"></div>
    </div>

    <div class="victory-overlay" id="victoryOverlay">
        <h2 class="victory-title">üèÜ VICTOIRE ! üèÜ</h2>
        <div class="winner-card" id="winnerCard">
            <img id="winnerImg" src="" alt="">
        </div>
        <div class="winner-name" id="winnerName"></div>
        <div class="victory-buttons">
            <button class="rematch-btn" onclick="rematch()">üîÑ REVANCHE</button>
            <button class="new-battle-btn" onclick="newBattle()">‚öîÔ∏è NOUVEAU COMBAT</button>
        </div>
    </div>

    <script>
        let allCharacters = [];
        let selectedP1 = null;
        let selectedP2 = null;
        let fighter1 = null;
        let fighter2 = null;
        let currentTurn = 1;
        let battleEnded = false;
        let autoMode = false;
        let currentStep = 1;
        let pendingSelection = null;

        function parseINI(text) {
            const lines = text.split('\n');
            const result = {};
            let currentSection = null;

            for (let line of lines) {
                line = line.trim();
                if (!line || line.startsWith(';') || line.startsWith('#')) continue;
                
                if (line.startsWith('[') && line.endsWith(']')) {
                    currentSection = line.slice(1, -1).trim();
                    result[currentSection] = {};
                    continue;
                }
                
                const equalIndex = line.indexOf('=');
                if (equalIndex > -1 && currentSection) {
                    const key = line.slice(0, equalIndex).trim();
                    let value = line.slice(equalIndex + 1).trim();
                    
                    if ((value.startsWith('"') && value.endsWith('"')) || 
                        (value.startsWith("'") && value.endsWith("'"))) {
                        value = value.slice(1, -1);
                    }
                    
                    result[currentSection][key] = value;
                }
            }
            
            return result;
        }

        async function loadINI(filepath) {
            try {
                const response = await fetch(filepath);
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                const text = await response.text();
                return parseINI(text);
            } catch (error) {
                console.error(`Erreur lors du chargement de ${filepath}:`, error);
                return {};
            }
        }

        async function loadCharacters() {
            const factions = [
                { name: 'Alliance', file: './data/alliance.ini', class: 'alliance' },
                { name: 'R√©bellion', file: './data/rebellion.ini', class: 'rebellion' },
                { name: 'Tr√©fonds', file: './data/trefonds.ini', class: 'trefonds' }
            ];

            const characters = [];

            for (const faction of factions) {
                const data = await loadINI(faction.file);
                
                for (const [name, stats] of Object.entries(data)) {
                    if (stats['zz CreationCarte'] === 'Faite') {
                        characters.push({
                            name: name,
                            faction: faction.name,
                            factionClass: faction.class,
                            niveau: parseInt(stats.Niveau) || 0,
                            attaque: parseInt(stats.Attaque) || 0,
                            defense: parseInt(stats.Defense) || 0,
                            strategie: parseInt(stats.Strategie) || 0,
                            vitesse: parseInt(stats.Vitesse) || 0,
                            pv: parseInt(stats.PV) || 0,
                            pointsTotaux: parseInt(stats.PointsTotaux) || 0
                        });
                    }
                }
            }

            characters.sort((a, b) => b.pointsTotaux - a.pointsTotaux);
            return characters;
        }

        function displayCharacterGrid(characters, containerId) {
            const grid = document.getElementById(containerId);
            grid.innerHTML = characters.map((char) => `
                <div class="character-card ${char.factionClass} revealed" 
                     data-name="${char.name}" 
                     onclick="openStatsModal('${char.name}')">
                    <div class="character-card-inner">
                        <div class="character-card-front">
                            <img src="./cards/${char.name}.png" alt="${char.name}" class="character-card-bg" 
                                 onerror="this.src='./cards/dos.png'">
                            <div class="character-card-content">
                                <div class="faction-badge ${char.factionClass}">${char.faction}</div>
                                <h3>${char.name}</h3>
                                <div class="character-card-info">Niv.${char.niveau}</div>
                            </div>
                        </div>
                        <div class="character-card-back">
                            <img src="./cards/dos.png" alt="Dos de carte">
                        </div>
                    </div>
                </div>
            `).join('');

            setTimeout(() => initCardTiltEffect(containerId), 100);
        }

        function initCardTiltEffect(containerId) {
            if (window.matchMedia('(max-width: 768px)').matches || 'ontouchstart' in window) {
                return;
            }
            
            const cards = document.querySelectorAll(`#${containerId} .character-card.revealed`);
            
            cards.forEach(card => {
                const inner = card.querySelector('.character-card-inner');
                if (!inner) return;
                
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    const rotateY = ((e.clientX - centerX) / (rect.width / 2)) * 10;
                    const rotateX = -((e.clientY - centerY) / (rect.height / 2)) * 10;
                    
                    inner.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
                    inner.classList.add('tilt');
                });
                
                card.addEventListener('mouseleave', () => {
                    inner.style.transform = 'rotateY(0deg) rotateX(0deg)';
                    inner.classList.remove('tilt');
                });
            });
        }

        function openStatsModal(name) {
            const char = allCharacters.find(c => c.name === name);
            if (!char) return;

            pendingSelection = char;

            document.getElementById('modalCardImg').src = `./cards/${name}.png`;
            document.getElementById('modalName').textContent = name;
            document.getElementById('modalPV').textContent = char.pv;
            document.getElementById('modalATK').textContent = char.attaque;
            document.getElementById('modalDEF').textContent = char.defense;
            document.getElementById('modalSTR').textContent = char.strategie;
            document.getElementById('modalVIT').textContent = char.vitesse;
            document.getElementById('modalLVL').textContent = char.niveau;

            const selectBtn = document.getElementById('modalSelectBtn');
            if (currentStep === 1) {
                selectBtn.className = 'select-btn';
                selectBtn.textContent = 'S√âLECTIONNER JOUEUR 1';
            } else {
                selectBtn.className = 'select-btn p2';
                selectBtn.textContent = 'S√âLECTIONNER JOUEUR 2';
            }

            document.getElementById('statsModal').classList.add('active');
        }

        function closeStatsModal() {
            document.getElementById('statsModal').classList.remove('active');
            pendingSelection = null;
        }

        function confirmSelection() {
            if (!pendingSelection) return;

            if (currentStep === 1) {
                selectedP1 = pendingSelection;
                document.getElementById('selectedImgP1').src = `./cards/${selectedP1.name}.png`;
                document.getElementById('selectedCardP1').classList.remove('empty');
                document.getElementById('selectedHpP1').style.display = 'block';
                document.getElementById('selectedHpValueP1').textContent = selectedP1.pv * 5;
                document.getElementById('nextToP2Btn').disabled = false;
            } else {
                selectedP2 = pendingSelection;
                document.getElementById('selectedImgP2').src = `./cards/${selectedP2.name}.png`;
                document.getElementById('selectedCardP2').classList.remove('empty');
                document.getElementById('selectedHpP2').style.display = 'block';
                document.getElementById('selectedHpValueP2').textContent = selectedP2.pv * 5;
                document.getElementById('startBattleBtn').disabled = false;
            }

            closeStatsModal();
        }

        function goToStep2() {
            currentStep = 2;
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            displayCharacterGrid(allCharacters, 'gridP2');
        }

        function filterGrid(searchTerm, gridId) {
            const filtered = allCharacters.filter(char => 
                char.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            displayCharacterGrid(filtered, gridId);
        }

        function getDodgeChance(vitesse) {
            if (vitesse >= 512) return 1/6;
            if (vitesse >= 256) return 1/8;
            if (vitesse >= 128) return 1/10;
            if (vitesse >= 64) return 1/12;
            if (vitesse >= 32) return 1/20;
            return 1/30;
        }

        function calculateBonuses(attacker, defender) {
            const strategieDiff = attacker.strategie - defender.strategie;
            let bonusStrategie = strategieDiff > 0 ? Math.min(strategieDiff, 60) : 0;

            const defenseDiff = defender.defense - attacker.defense;
            let bonusDefense = defenseDiff > 0 ? Math.min(defenseDiff, 60) : 0;

            return { bonusStrategie, bonusDefense };
        }

        function performAttack(attackerId) {
            if (battleEnded) return;

            const attacker = attackerId === 1 ? fighter1 : fighter2;
            const defender = attackerId === 1 ? fighter2 : fighter1;
            const defenderHpId = attackerId === 1 ? 'hp2' : 'hp1';
            const damageTextId = attackerId === 1 ? 'damage2' : 'damage1';
            const dodgeTextId = attackerId === 1 ? 'dodge2' : 'dodge1';

            const dodgeChance = getDodgeChance(defender.vitesse);
            const isDodge = Math.random() < dodgeChance;

            if (isDodge) {
                showDodge(dodgeTextId);
                addLog(`${defender.name} esquive l'attaque de ${attacker.name} !`, 'dodge');
                
                // M√äME EN CAS D'ESQUIVE, on change de tour
                const nextTurn = attackerId === 1 ? 2 : 1;
                currentTurn = nextTurn;
                updateTurnIndicator(nextTurn);
                updateAttackIndicator(nextTurn);
                
                if (autoMode && !battleEnded) {
                    setTimeout(() => performAttack(nextTurn), 1200);
                }
                return;
            }

            const baseAttack = Math.floor(Math.random() * (attacker.attaque + 1));
            const { bonusStrategie, bonusDefense } = calculateBonuses(attacker, defender);
            
            let finalDamage = baseAttack;
            finalDamage += Math.floor(baseAttack * bonusStrategie / 100);
            finalDamage -= Math.floor(baseAttack * bonusDefense / 100);
            finalDamage = Math.max(0, finalDamage);

            defender.currentHp -= finalDamage;
            if (defender.currentHp < 0) defender.currentHp = 0;

            showDamage(damageTextId, finalDamage);
            document.getElementById(defenderHpId).textContent = defender.currentHp;

            let logMessage = `${attacker.name} inflige ${finalDamage} d√©g√¢ts √† ${defender.name}`;
            if (bonusStrategie > 0) logMessage += ` (+${bonusStrategie}% strat)`;
            if (bonusDefense > 0) logMessage += ` (-${bonusDefense}% def)`;
            addLog(logMessage, 'attack');

            if (defender.currentHp <= 0) {
                endBattle(attackerId);
                return;
            }

            const nextTurn = attackerId === 1 ? 2 : 1;
            currentTurn = nextTurn;
            updateTurnIndicator(nextTurn);
            updateAttackIndicator(nextTurn);

            if (autoMode && !battleEnded) {
                setTimeout(() => performAttack(nextTurn), 1200);
            }
        }

        function playerAttack(playerId) {
            if (battleEnded) return;
            if (autoMode) return;
            if (playerId !== currentTurn) return;

            performAttack(playerId);
        }

        function showDamage(elementId, damage) {
            const element = document.getElementById(elementId);
            element.textContent = `-${damage}`;
            element.classList.remove('show');
            void element.offsetWidth;
            element.classList.add('show');
        }

        function showDodge(elementId) {
            const element = document.getElementById(elementId);
            element.classList.remove('show');
            void element.offsetWidth;
            element.classList.add('show');
        }

        function updateTurnIndicator(playerId) {
            const turnName = document.getElementById('turnName');
            const fighter = playerId === 1 ? fighter1 : fighter2;
            turnName.textContent = fighter.name;

            document.getElementById('combatant1').classList.toggle('active', playerId === 1);
            document.getElementById('combatant2').classList.toggle('active', playerId === 2);

            document.getElementById('card1').classList.toggle('disabled', playerId !== 1);
            document.getElementById('card2').classList.toggle('disabled', playerId !== 2);
        }

        function updateAttackIndicator(playerId) {
            const indicator = document.getElementById('attackIndicator');
            indicator.classList.remove('point-left', 'point-right');
            indicator.classList.add(playerId === 1 ? 'point-right' : 'point-left');
        }

        function addLog(message, type) {
            const log = document.getElementById('battleLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            log.insertBefore(entry, log.firstChild);
        }

        function endBattle(winnerId) {
            battleEnded = true;
            const winner = winnerId === 1 ? fighter1 : fighter2;
            const loserCardId = winnerId === 1 ? 'card2' : 'card1';

            document.getElementById(loserCardId).classList.add('ko');
            addLog(`üèÜ ${winner.name} remporte le combat !`, 'victory');

            setTimeout(() => {
                document.getElementById('winnerImg').src = `./cards/${winner.name}.png`;
                document.getElementById('winnerName').textContent = winner.name;
                document.getElementById('victoryOverlay').classList.add('show');
            }, 1000);
        }

        function startBattle() {
            if (!selectedP1 || !selectedP2) return;

            fighter1 = { ...selectedP1, currentHp: selectedP1.pv * 5 };
            fighter2 = { ...selectedP2, currentHp: selectedP2.pv * 5 };

            document.getElementById('cardImg1').src = `./cards/${fighter1.name}.png`;
            document.getElementById('cardImg2').src = `./cards/${fighter2.name}.png`;
            document.getElementById('name1').textContent = fighter1.name;
            document.getElementById('name2').textContent = fighter2.name;
            document.getElementById('hp1').textContent = fighter1.currentHp;
            document.getElementById('hp2').textContent = fighter2.currentHp;

            document.getElementById('card1').classList.add(fighter1.factionClass);
            document.getElementById('card2').classList.add(fighter2.factionClass);

            currentTurn = fighter1.vitesse >= fighter2.vitesse ? 1 : 2;
            battleEnded = false;

            addLog(`Combat : ${fighter1.name} VS ${fighter2.name}`, 'info');
            addLog(`${currentTurn === 1 ? fighter1.name : fighter2.name} commence`, 'info');

            updateTurnIndicator(currentTurn);
            updateAttackIndicator(currentTurn);

            document.getElementById('selectionPhase').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('battlePhase').style.display = 'block';

            initCombatCardEffects();

            autoMode = document.getElementById('autoBattle').checked;
            if (autoMode) {
                setTimeout(() => performAttack(currentTurn), 1000);
            }
        }

        function initCombatCardEffects() {
            const cards = document.querySelectorAll('.combat-card-container');
            
            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    
                    card.style.setProperty('--mouse-x', x + '%');
                    card.style.setProperty('--mouse-y', y + '%');
                    
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const angleX = (e.clientX - centerX) / 10;
                    const angleY = (e.clientY - centerY) / 10;
                    const angle = Math.atan2(angleY, angleX) * (180 / Math.PI) + 90;
                    
                    card.style.setProperty('--shine-angle', angle + 'deg');
                    
                    const rotateY = ((e.clientX - centerX) / (rect.width / 2)) * 8;
                    const rotateX = -((e.clientY - centerY) / (rect.height / 2)) * 8;
                    card.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'rotateY(0deg) rotateX(0deg)';
                });
            });
        }

        function rematch() {
            document.getElementById('victoryOverlay').classList.remove('show');
            document.getElementById('battleLog').innerHTML = '';
            document.getElementById('card1').classList.remove('ko');
            document.getElementById('card2').classList.remove('ko');
            document.getElementById('card1').className = 'combat-card-container';
            document.getElementById('card2').className = 'combat-card-container';
            
            startBattle();
        }

        function newBattle() {
            document.getElementById('victoryOverlay').classList.remove('show');
            document.getElementById('battlePhase').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('selectionPhase').style.display = 'flex';
            document.getElementById('battleLog').innerHTML = '';
            document.getElementById('card1').classList.remove('ko');
            document.getElementById('card2').classList.remove('ko');
            document.getElementById('card1').className = 'combat-card-container';
            document.getElementById('card2').className = 'combat-card-container';
            
            currentStep = 1;
            selectedP1 = null;
            selectedP2 = null;
            
            document.getElementById('step1').style.display = 'block';
            document.getElementById('step2').style.display = 'none';
            
            document.getElementById('selectedImgP1').src = './cards/dos.png';
            document.getElementById('selectedCardP1').classList.add('empty');
            document.getElementById('selectedHpP1').style.display = 'none';
            document.getElementById('nextToP2Btn').disabled = true;
            
            document.getElementById('selectedImgP2').src = './cards/dos.png';
            document.getElementById('selectedCardP2').classList.add('empty');
            document.getElementById('selectedHpP2').style.display = 'none';
            document.getElementById('startBattleBtn').disabled = true;
            
            document.getElementById('searchP1').value = '';
            document.getElementById('searchP2').value = '';
            
            displayCharacterGrid(allCharacters, 'gridP1');
        }

        document.getElementById('autoBattle').addEventListener('change', function(e) {
            autoMode = e.target.checked;
            if (autoMode && !battleEnded && document.getElementById('battlePhase').style.display === 'block') {
                performAttack(currentTurn);
            }
        });

        document.getElementById('searchP1').addEventListener('input', function(e) {
            filterGrid(e.target.value, 'gridP1');
        });

        document.getElementById('searchP2').addEventListener('input', function(e) {
            filterGrid(e.target.value, 'gridP2');
        });

        document.getElementById('nextToP2Btn').addEventListener('click', goToStep2);
        document.getElementById('startBattleBtn').addEventListener('click', startBattle);

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeStatsModal();
            }
        });

        async function init() {
            try {
                allCharacters = await loadCharacters();
                displayCharacterGrid(allCharacters, 'gridP1');
                console.log(`‚úÖ ${allCharacters.length} personnages charg√©s`);
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        }

        init();
    </script>
</body>
</html>
